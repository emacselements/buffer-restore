# buffer-restore

Save and restore Emacs frame configurations with precise buffer states.

## Overview

`buffer-restore` provides manual session management for Emacs, giving you explicit control over saving and restoring workspace layouts. Unlike `desktop-save-mode`, this package lets you save multiple named sessions/workspaces and choose exactly when to save or restore them.

**Key Features:**
- üìÅ **Sessions**: Save single frame configurations (window layouts + buffer states)
- üñ•Ô∏è **Workspaces**: Save multiple frames with positions and sizes
- üìÑ **Smart Buffer Restoration**: Preserves exact positions in PDFs (pdf-tools), EPUBs (nov-mode), and regular files
- üéØ **Precise State**: Remembers PDF pages, EPUB chapters, scroll positions, and cursor locations
- üîÑ **Multiple Named Saves**: Keep different configurations for different workflows

## Installation

### Manual Installation

1. Clone this repository or download `buffer-restore.el`:
```bash
git clone https://github.com/emacselements/buffer-restore.git
```

2. Add to your Emacs configuration:
```elisp
(add-to-list 'load-path "/path/to/buffer-restore")
(require 'buffer-restore)
```

### Using `use-package`

```elisp
(use-package buffer-restore
  :load-path "/path/to/buffer-restore"
  :commands (buffer-restore-save-session
             buffer-restore-load-session
             buffer-restore-save-workspace
             buffer-restore-load-workspace))
```

## Usage

### Sessions (Single Frame)

Sessions capture the window layout and buffer states of a single frame.

#### Save a Session
```elisp
M-x buffer-restore-save-session
```
Enter a name for your session (e.g., "writing", "coding", "research").

#### Load a Session
```elisp
M-x buffer-restore-load-session
```
Select from your saved sessions using completion.

#### List All Sessions
```elisp
M-x buffer-restore-list-sessions
```
View all saved sessions with timestamps.

#### Delete a Session
```elisp
M-x buffer-restore-delete-session
```

### Workspaces (Multiple Frames)

Workspaces capture all frames with their positions, sizes, and complete window/buffer states.

#### Save a Workspace
```elisp
M-x buffer-restore-save-workspace
```
Saves all currently open frames, including their screen positions.

#### Load a Workspace
```elisp
M-x buffer-restore-load-workspace
```
Restores all saved frames with their original positions and layouts. **Note**: This closes all existing frames first.

#### List All Workspaces
```elisp
M-x buffer-restore-list-workspaces
```

#### Delete a Workspace
```elisp
M-x buffer-restore-delete-workspace
```

## What Gets Saved?

### For Each Window:
- **PDF files** (pdf-tools): Current page, zoom level, slice settings, scroll position
- **EPUB files** (nov-mode): Current chapter/document index, reading position
- **Regular files**: Cursor position, line/column, window scroll
- **Special buffers**: Buffer name and major mode (when restorable)

### For Each Frame (in Workspaces):
- Frame dimensions (width/height in characters and pixels)
- Frame position on screen
- Complete window tree (split configuration)
- Which frame was selected/focused

## Configuration

### Custom Storage Directory

By default, sessions are stored in `~/.emacs.d/buffer-restore-sessions/` and workspaces in `~/.emacs.d/buffer-restore-workspaces/`.

To change this:
```elisp
(setq buffer-restore-directory "~/my-sessions")
```

## Examples

### Workflow Example

```elisp
;; Save your "morning reading" session with PDFs and notes
M-x buffer-restore-save-session RET morning-reading

;; Switch to coding layout
M-x buffer-restore-load-session RET coding-project

;; Save entire workspace with multiple frames
M-x buffer-restore-save-workspace RET multi-monitor-setup
```

### Keybindings (Optional)

Add these to your config for quick access:
```elisp
(global-set-key (kbd "C-c s s") 'buffer-restore-save-session)
(global-set-key (kbd "C-c s l") 'buffer-restore-load-session)
(global-set-key (kbd "C-c w s") 'buffer-restore-save-workspace)
(global-set-key (kbd "C-c w l") 'buffer-restore-load-workspace)
```

## Advanced Features

### Debugging

To inspect what would be captured:
```elisp
M-x buffer-restore-debug-current-state    ; Debug single frame
M-x buffer-restore-debug-workspace        ; Debug all frames
```

This shows the internal data structure that will be saved, useful for troubleshooting.

## Supported Major Modes

- `pdf-view-mode` (pdf-tools) - Full support including page, zoom, and slice
- `nov-mode` (EPUB reader) - Chapter and position restoration
- File-backed buffers - Cursor position and scroll state
- Special buffers (like `*scratch*`) - Best-effort restoration

## Limitations

- Terminal frames may not restore positions accurately (X11-specific features)
- Some special buffers cannot be fully restored (e.g., process buffers)
- External file changes between save/restore are not detected
- Requires files to exist at their original paths

## Requirements

- Emacs 26.1 or higher
- Optional: `pdf-tools` for PDF support
- Optional: `nov.el` for EPUB support

## License

This package is free software; you can redistribute it and/or modify it under the terms of your choice.

## Contributing

Contributions, bug reports, and feature requests are welcome! Please file issues or pull requests on the GitHub repository.

## Author

Rari Comninos

## See Also

- [pdf-tools](https://github.com/vedang/pdf-tools) - PDF viewer for Emacs
- [nov.el](https://depp.brause.cc/nov.el/) - EPUB reader for Emacs
- `desktop-save-mode` - Built-in Emacs session management (automatic, single session)
- `frameset` - Built-in frame configuration support (lower-level)

